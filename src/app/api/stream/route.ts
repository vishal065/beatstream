import { prismaClient } from "@/app/lib/db";
import { NextRequest, NextResponse } from "next/server";
import { z } from "zod";
//@ts-expect-error because youtube-search-api dont have types
import youtubesearchapi from "youtube-search-api";
import { YT_REGEX } from "@/app/lib/utlis";



const createStreamSchema = z.object({
  creatorId: z.string(),
  url: z.string(),
});
export async function POST(req: NextRequest) {
  try {
    const data = createStreamSchema.parse(await req.json());
    const isYt = YT_REGEX.test(data.url);
    const isYt2 = data.url.match(YT_REGEX);
    console.log("isYt-2", isYt2);

    if (!isYt) {
      return NextResponse.json(
        { message: "Wrong URL format" },
        { status: 411 }
      );
    }
    const extractedId = data.url.split("?v=")[1];

    const res = await youtubesearchapi.GetVideoDetails(extractedId);
    const thumbnails = res.thumbnail.thumbnails;
    thumbnails.sort((a: { width: number }, b: { width: number }) =>
      a.width < b.width ? -1 : 1
    );

    const stream = await prismaClient.streams.create({
      data: {
        userId: data.creatorId,
        url: data.url,
        extractedId,
        type: "youtube",
        title: res.title ?? "cant find video",
        smallImg:
          (thumbnails.length > 1
            ? thumbnails[thumbnails.length - 2].url
            : thumbnails[thumbnails.length - 1].url) ??
          "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxIRDxAQEhIWFRUVEhYVFRgWFRUXFxYYFxUXFhYVGBYbHSggGBolGxcVITEiJSkrLi4uFyAzODMtNygtLysBCgoKDg0OGBAQGyslHx0rListLS0tLS0rLS0rLS0rLS0tLS0tLSstLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAOEA4QMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAQYDBQcEAv/EAEcQAAEDAgMECAIGBwQLAQAAAAEAAgMEEQUSIQYxQVEHExQiYXGBkTKhQlJygrHBFWKSotHh8CMzwtIkQ0RTVFVjc5Oy0xb/xAAZAQEBAQEBAQAAAAAAAAAAAAAAAQIDBAX/xAAiEQEBAAICAgIDAQEAAAAAAAAAAQIRAyESMRNRIkFhBDL/2gAMAwEAAhEDEQA/AO4BECIgpUKUUREQEREBERAREQEREBERAREQEREBERAREQFBUqEEIpKhVBERBIRAigKVClFEREBERAREQEREBERAREQEREBERAREQEREBQpUIChSgVRCIiCQiBFAUqFKKIiICKLrFNUsZq97W/aIH4oMyLwjGaY6Coh/8rP4qqbU9I0NO7qKVvaqgm2VhJY0+LgDmP6o9bKXKRZjau7nAanRVPGOkbDqclpn6xw0yxDPqOGYd0H1VKlwTEMRJfiFQ6OM/wCojIsB9kEtHrmK3uF7NUlOB1cLbj6Thmd53O70sseVvp08JPbyO6TKucnseHOLeDpCbfIAfvLEcY2gl/4eEeTfzLlZ0U7+13J6ipOpMbk+PEQ37A/ysH4qP0Din/Npf3/8ytyJ4r5fyKkKDGo/7vEs32/5tcszcX2gi39RMPJtz7Fqs6Jr+nl/Ir0XSfUQODa6gfGPrxk29naH9pW7AdtqGsIbDOM5+g/uP9A74vS68LhcWOoVfxjY2kqBfq+rfe+eOzTfxFrH2um8omsb/HTwVK42zEMWwlrsru104GmfM4x+OhzNHqW2HBML27xirzGBtKbbwBYjxyukvbxV+SJ8V/TsiLlX/wCj2gbr2enf6D/6hZW9JdZBrWYc5rB8T43Gw8bEFvu4K/JE+LJ1BQtDs7thR12kEt32uY3DLIOfdPxDxbcLfLUu2LLPYgRAtMoREQSEQIoClQpRXzI8NBJNgNSTuA5lc8xzpLBlNPh0JqZPr69WPK3xDxuB4lYOmismbHSwh5ZTzPc2ZwG+xblafC2c245V7cKwyGkiDImgDS5+k823uPFcs89O/HxeWv3toJMOxer71TXGEHXq4riw5dyw9yViHR1A43lnmkdxJLdfcE/NW0zHkvkPJO9cLyYvZP8ALnr3IrJ6OqK3+s/bH8FtNndmYKLOY7uc4/E/KXAfVBAGi3TQpXXGT3p5c7Zdb2IiLbmIiICIiAiIgIiICpu0OyrmP7ZQf2czdSxtg1442G654jcfNXJFLNrLYrmzO04q4zcBkrP7xnEW0zAHW1/Y6LeslB0IVN2zwp9PIMSpdHtI65oGjhxcRy3A+h4Ky4HWsqImTsPdcL24g8WnxB0Xn/OZae/H4s+O3XcVnHcPjZi+Ftp2COR8wc8s00D262GnwiS/NdnXKdh4e241U1h1jpW9VHyLjdoPt1h+8F1ZenjfO5b3IIEQLq5IREQSEQIoClQpRVd29wHt2HzQNA6zR8V/rt1AvwuLt+8qbsVivaaMNdfrIbRvB36DuutwuNPNpXVFyPbPD3YViIxGJpNPUOInaBo15NybcL/EPHMNLrlyY7ejg5LjVhWWED1WNkjZGNljIc1wDgRuIO4r0RNsF5cML5Pp83Pj8W5+32iIvW+SIiICIiAiIgIiICIiAiIg+XsDgQRcEEEcwd4XLpq6XC31tG0EiQZoCN7c2gd4nLp5tXU1TOkJhhdR4g0DNBM0EEXuL5x8wR95Yyn7b473pe+jvZ/sNBHG4f2j/wC0l8HOA7v3QAPQqzLHTyh7Gvbuc0OHkRcLIu0mo4W7uxAiBaZQiIgkIgRQApUBSii8mK0cU0EkUzQ6NzSHg7rcTfhbffgvWtFtxU9Vhla8aHs7wPNwyj5lS+lntzDoyMhdU5HXpg9wY1xu69wWkcu6RfxV9VV6OqcMo4+bgXn1cbfKytS5YTp2zvYiItMiIvkuHNS2T2uONy9R9Kl7W7bdmlMELGue22cuvlaTYhoA3m2v8eFzBXJdvcFmjq5ZshdHK7MHAEgEgXa6243B9PVYzy66dMMPy1kt2x+2Pa3mGVgZJYuaW3yuA379xF9ytq5d0dYFKaltS5jmxxh2UkWzOILQBfeLF2vguoq4W2ds8kky6EWuqsbp4pepllbG7JnGfutIuRo46E6blpY9uYc7i6ORsGYtZPlLmOcN/dAu0ct61cpEmGV9Ra1Wts9p+xNjaxodJJcjNfK0C13G2p1IsPP12+DYj2iETZHMDi7KHby0OIa/yIsVoNv9nJKtkckOskdxluBma6x0J4gj5nwUy9dGEnl21Oz/AEgSPnZHUMZle4NDmAjKSbC4JNxf2XQ1yTANjap9RGZYjGxrw5znWGjTezRe5JsusudZZxtk3XTPCZZawfS0G3cGfDqkcmh37LgVuxKFrNrATQVQa0uJhcLDy1PoLn0V8plOkvFlhZ5RZ9gqgyYXQvO/qGNP3Rl/Jb5U/onqWvwmna11zGXsd+q7OXW9nA+quC7Y+o82fVogRAtMoREQApUBSiAUqApUaFUOlh9sHqvExD3mjVvVT6VIS7B6sDgI3fsyscfkCs5emsfcVzZDSmph/wBBn/qCrAqvsvL/AKLSHlEwewAKtCxj6dcvYiIqygrykL1qLLlycfk9X+f/AETj3LGCEG69CIrhh4zTHPzfJlvQiIujgq3SNE3sXWOaDkmiOoG4uyuHkbrU7QSy1MdRR0lOZGsDWyPaQ1rDcEMaDYE6K3bQ4d2mkng4vYcv2h3m/vAKi4FBVunb2UTUzsuep61pMJlbpo07yT/JcOTHeUezg5fHjykWun2njYWxVUclK+1gJmFrTYcH/Cfkt7HK1wu1wI8CDv3LX021IklbQYrTRNMgtG8EPhlNwLAO1YSStZtNg7MHnhq6ZrGU0r2QTsPWOy3c93XXvoA24+VtdOvp5PdWZY5GXWQFEyxmU1WuPkvHluPP1RWYN0svpFnHjmLpy/6MuSaqq9HE5o8WqqE6Mmb1kY4Xbc6fdLh9wLrC45M7Jj2GPH0nFh8jmb/jXY104/p5+Wdy/YiIurkhERAClAiAFKgKVFFrtoaDtFHU0/GSF7B5lpyn3stioISjimwlUXUpicLOie5hB3jW49iSPRXekkzNHMaFU/aSlOGYu5/+z1hLr8Gvv3r+TiT5P8FYaebKb8OPkuM66ejLvv7bVFDTcXClaYEREBERARfTWE7gSsopH8lnzjp8WTAi9QoXcwp7A7mPmp5w+L+qlt5EDQSyXIfFlkjcNC1zXCxB4Lc9IbycJhYTcyzUsbr/AEg6RhcD52K13SHSuGHyDi+SKMfelaF7+kgEx4ZCB8WIweoY15P4BTynZcLLjHrRS5pG8KFuWX0zljZ7F8SvytJ8F9rXYpVta11yA1oLnHgLKsq1E3rcfw6MfQBefQPd/hC7IuW9E9EaiqrMTeNL9VDfgNC633QwepXUleOdJy3vX0IiBdHJCIiCQiBEAKVAUqKIiINLtZs7FX0z4JN/xMdxY8DRw8OY4hcpocRloJuwVwyllhHJrlc3gc3Fvjw3G1l3BavH8Ap62IxVEYeN7Tucw2tmY7e0rGWO+43hnrq+lRpqnL4tP9aLYseCLg3VTrNhcRoXE0MgqIf93IQHj0NmnzaR5LwDayWndlq6WWB32TY+jrfIlY3r26eO/S+oqrTbe0btHPLfNjv4KzU87ZGNkYQ5rmhzSNxBFwVZZUuNntkWWGwILgbLEvdDOwNDT8wufJf078M6t09UcjSNCF9rymkYdRp5FOyuG55XPbWsft60Xk6qTg8J1Uv1gh4z7eDazC5amBjInMa9k0co6zNkcY3Zg021AutdPQ4hU1NG+pFMyOnlMv8AZPkc55yFoFnNFtTzVg7O/i9R2QfScT6oeOP2+6idgFt61rxbfovfGYm31C89czrmd1ruQNtP6urLZV1NaaisxBrWk3AA3uJsAPNUwGXGKgUdLcQAgzSkG1gf6sN5Phdbqg6N6uqfnxGoswHSKI77btbZW+xPiulYVhUNLE2GCMMYOAG88yd5PidV3mNvt5blMfXtOEYbHTQRwRCzI2ho5+JPMk3JPivWpULq40QIgREIiIJCIEVBSoUqKIiICLV4ntFSUzgyepijcdzXPAdbnbeAvfTVDJGNexzXtcLtc0gtI5gjQps0yLlPShijquqiwqE91pbJO4cNLhvoDfzLV0LafGW0VJNUv+g3uj6zzoxvq4hcp2Mo3Fj6uUl0tQ4uLjvLSb/M6+Vlzzv6deOa/Jv6LAqdws6CNwaA0XY07hztqt3GwNAa0AAAAAaAAaAAcAoiZlAC+1JFttF56k2dG47g4X97/kvjFqd8kErIn5HuYQ131Tw1G5Uyg2pfDajr2OY9ujZTch4HFx46Ed4X8bLlzf8ALpxb268MKi5H3OnksRwwjQSHLy4+6+8OxFr4IntcHBzGm7SCDpzX26qJ8FrLPjntiXk+2N2FD6L3A+6+Dhz9wk377j8Fl613P8FHWu5rF5OP6al5Ptrp3uZUx0zSSXxufc7gGmxuscEJdWyQOcS1kDXkjQ5nOIt5ZR818U7i/FiSfgoxb78n8kwmUnEcRfYEN6hnswk/MqzLD2XPP02WNQsjp3ENANgAba6kDeuc1GM1mF1BqTeajlLc7L/3RIA7t/hPyN7Gx1W72726p4minbeSbOLsZrl5BzuBuRoLnwWPB53VdKe0U/VB92mN1zdttDYgEe3BPee8fom5h+S+YZXx1ELJ4nBzHi7SOI/Ig3FvBepcz6Iql0EtfhjzcQv6yM3+i42d5fQd5uK6YvRjdxwymroUKVC0yIEQIiEREBSgRUFKhSoosNXLkje/fla53sCfyWZfEzA5padxBB8joUHBtmMOZXNnq6kdZJLK65JOlwDpr42HIAKz9GGIOpa6owx7yWEGSnB4fSLR5tN/NhWk2LZ1LqykPxQzuHpcs/wfNejaSilEsFbTC80Ds1uLmjW1uPEW4hxXnnXb1Zd7ja9LlYZ6miwxh3u66W3Aatbr4NEp9lscPhFwANGjQcraBU7CsRdXYtVVjmFlo2tDCb5NGtte36rj95XrDx3SfFandtZs8ZI9SIi0wLyYnhkNSzq5ow8cL7x4tI1afEKu4xszUdofVUdSWPdq5jj3TwsN4tpuIK8wxHGY+66ljk8QRr46PH4BZt+43MfqvO8TYLURPikL6SWTK6Nx+G+p8M1rkEb7WPNdSbVt/q65ezCq7EZozWBkUMTw4sba58NCeRFyeOiv914eXKb6emYbnbampZzCls7OY91qkXPzqfHHuw2RrqqoI4Njb8iVrDUZY8QfEAJHOlykDUuayzfPVYTTva9z4pSwusXCwINhYeSy0kORuW+Y3JJ5km5Nlu8nSTi72pHRlBA6J0hs6pD3Zy7V4B3EX1AOtzxN1Z8ZxuClYXyvAPBoIL3HkGrWVewkFXWOLXvhc4FzzHbU6XNjuuSNy3uDdF9BA4PeHzuGt5Tdt+eQAA+t16+K3LHpy5PGZdtd0TYdI91XiczS01DssYIt3Ablw5gnKAf1L8V0hQ1ttApXpk1NPPld3YoUqFWRAiBEQiIgkIgRUFKhSooiIg5Ft/Sfo/FI65t+pqe7Nxs8WB9wGu8bOWzY8OAINwRcEcQdxV6xzC4qqnkp5hdjxY8weDmng4HUFchq6aqwd5jkaZqTN3JWjVoPA/VPgdL7iuWU1d/p3wvlNfth2T0rcSB39YCPLPJ/EK9Ye7ukciubUGMQtxMysdeOdoBuCMrjYC9/Fv7yv9PJldf3WcK1yTttUUA31UrbmIi8GN4qykhM0jXFoIByC510ueAHiUHopdJJBz1/r3X3BWRPc5jJGOc34g1wJb5gblV6TbOilk/vTHmaRd7S21xb4tRy4rSwURwuRtU9zZQ4ObEGOPfuNXONrAAa6X1IXzvj3a9u+o6SpVQr8dkq8Nllp2uY9rg2QNJLmjeS0jUi1vS68vRxPO50wcXOhsLFxJs++5pPhe/kFn47q1fJYMZ2lp6V7Y5C4uIvZrb5RuBOo5HxW0pqhsjGyMN2uAc08wdQuebQdmrq1oimLHm0ZLmHI4g2BaQb34aix0WzxPHHUghw2ib1s4blJIuGXF7kbrm9+QG9avH1Ne0mTZ45U1sRM1FYvjfd7SAc7ACC2x36gbiDyVm2I2wixGIkDJMwDrYyfh4Zmni0/LcVWdlMLqYBI+pnMj5CDlvdrLXvY8zcbhbRajE39hxmjqorATu6uVo0BzFrSSPEOB82r18ON45I8/JrO3TsiLFHKDpxWVep5RQpUICBECIhERBIRQpVAKVAUqKL5e6wJX0oc2+iDxk33r5ewOBBAIO8HUFZnQkbtVjLTyW3SWKftN0f0lTE/qo2wzb2vYMovyc0aEHyVLw/Hn0z+yV7XRyMFg92ocOBJG/7QuDZdjK8GL4NT1TMk8TZBwuNR9lw1b6Fc8uPfcbmX6qq0daC0OY4OadxBBB8iFsGVjTv0WhrOi8scX0VZJDrfK+7h5ZmkG3mCtbLgmOQHQR1AHIs198jlz/Ke414y+quomb9Ye6GRp0uPcKkdoxdvxYcT5fycU7Xip3Ya75/xU8k8KsWJYLRzgiSKO5+k0AOHiCNbqlYbhrO01GHTSu6mJpmifcDq7Bt9+gBDtRzbdbCX9NOabUYjHFxy3Hj3n/kUw/ZY9VUuqJr1EzQMwF2ts4OtfebloB00A08eHLlI7ceNb/ZV9HFDIyml6zLeR5OjzpvtYaWAAstXgW2r56lkLomtZIS0ZSbtuDa/A/JfGx2BuppnTTOaO4WBrbuvcjUm27Td+C3dFhFFDL10cdn62N3ENvvytJsPyXnuWMt/bpqtKNlKelqGTy1LWsEmZjXWaSQbgZidQNOC8OyFYxmIYgZSDI+Q9WbjVud7jlPIgxnyA5LYbYYO+rmjfG9oDWZSHXFje9xYG9/yHp8DY2KaCGJ7Xdc24MkelwXEhpBBuBcakX05Lphn6vupcerG9xDHY4hd72s+04XPkOKreAQPxXEo5srhTUzs2Yj4nghwHmSGm3ADhdWTDeiyhjOaQyzHk94aPZgbf1JV0oqNkTBHExrGN3NY0AD0Gi9uOFvdea3HH0y3XtasMcPP2WddbXHKihSoUZECIERCIiApUIqJClQFKiiIiAiIgiyjIOS+lgrakRsLzwQZOqHJR1I5LUnG+6SQBYX1zDhccON7eaxyY6bENbc2fbmC02bccnc+SDcmAL5NP4rUfppzc17Ealps4bmjQ3A1JJ08F8nG3kOAGuuXQ6d8sbmH73krtd1uez+Kxvw9jt4B82hapuNuLQbtvYF2/Qb3A8AQPJZTjR0s29za9nAakgb/IeVxw1Uvfs8q9v6Ki+o39kJ+io/qN/ZC178bdva3MLE7jrawDR4knfusCsgxo3tlsOZB+qHcPMjzad2iz44/S+eX22DaBg3AegCyiALz4fW9bn0+EjUXsbi/HVe1XUTyr4bEBwX0ApRVBERAUKVCAgRAiIREQERFRIUoiiiIiAiIgLBWfD6hEQebE98X/cH5L1t3nyCIgS7vVY4Pif5j8ERB8zfA/z/ADWSb4D9n8kRB9QfC3yCmPgiIJZx819oiAiIgIiIChSiCECIiIREQf/Z",
        bigImg:
          thumbnails[thumbnails.length - 1].url ??
          "data:image/jpeg;base64,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",
      },
    });

    return NextResponse.json({ message: "Added stream", id: stream.id });
  } catch (error) {
    console.log(error);

    return NextResponse.json(
      {
        message: "Error while adding a stream",
        error: error,
      },
      { status: 411 }
    );
  }
}

export async function GET(req: NextRequest) {
  try {
    const creatorId = req.nextUrl.searchParams.get("creatorId");

    const strems = await prismaClient.streams.findMany({
      where: {
        userId: creatorId ?? "",
      },
    });
    return NextResponse.json(
      { message: "Streams are", strems },
      { status: 200 }
    );
  } catch (error) {
    return NextResponse.json(
      { message: "Error while fetching the stream", error },
      { status: 411 }
    );
  }
}
